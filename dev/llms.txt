# dtplyr

## Overview

[![data.table seal of
approval](reference/figures/dt-seal.png)](https://rdatatable-community.github.io/The-Raft/posts/2024-08-01-seal_of_approval-dtplyr/)dtplyr
provides a [data.table](http://r-datatable.com/) backend for dplyr. The
goal of dtplyr is to allow you to write dplyr code that is automatically
translated to the equivalent, but usually much faster, data.table code.

See
[`vignette("translation")`](https://dtplyr.tidyverse.org/dev/articles/translation.md)
for details of the current translations, and
[table.express](https://github.com/asardaes/table.express) and
[rqdatatable](https://github.com/WinVector/rqdatatable/) for related
work.

## Installation

You can install from CRAN with:

``` r
install.packages("dtplyr")
```

Or try the development version from GitHub with:

``` r
# install.packages("pak")
pak::pak("tidyverse/dtplyr")
```

## Usage

To use dtplyr, you must at least load dtplyr and dplyr. You may also
want to load [data.table](http://r-datatable.com/) so you can access the
other goodies that it provides:

``` r
library(data.table)
library(dtplyr)
library(dplyr, warn.conflicts = FALSE)
```

Then use
[`lazy_dt()`](https://dtplyr.tidyverse.org/dev/reference/lazy_dt.md) to
create a “lazy” data table that tracks the operations performed on it.

``` r
mtcars2 <- lazy_dt(mtcars)
```

You can preview the transformation (including the generated data.table
code) by printing the result:

``` r
mtcars2 %>%
  filter(wt < 5) %>%
  mutate(l100k = 235.21 / mpg) %>% # liters / 100 km
  group_by(cyl) %>%
  summarise(l100k = mean(l100k))
#> Source: local data table [3 x 2]
#> Call:   `_DT1`[wt < 5][, `:=`(l100k = 235.21/mpg)][, .(l100k = mean(l100k)), 
#>     keyby = .(cyl)]
#> 
#>     cyl l100k
#>   <dbl> <dbl>
#> 1     4  9.05
#> 2     6 12.0 
#> 3     8 14.9 
#> 
#> # Use as.data.table()/as.data.frame()/as_tibble() to access results
```

But generally you should reserve this only for debugging, and use
[`as.data.table()`](https://rdatatable.gitlab.io/data.table/reference/as.data.table.html),
[`as.data.frame()`](https://rdrr.io/r/base/as.data.frame.html), or
[`as_tibble()`](https://tibble.tidyverse.org/reference/as_tibble.html)
to indicate that you’re done with the transformation and want to access
the results:

``` r
mtcars2 %>%
  filter(wt < 5) %>%
  mutate(l100k = 235.21 / mpg) %>% # liters / 100 km
  group_by(cyl) %>%
  summarise(l100k = mean(l100k)) %>%
  as_tibble()
#> # A tibble: 3 × 2
#>     cyl l100k
#>   <dbl> <dbl>
#> 1     4  9.05
#> 2     6 12.0 
#> 3     8 14.9
```

## Why is dtplyr slower than data.table?

There are two primary reasons that dtplyr will always be somewhat slower
than data.table:

- Each dplyr verb must do some work to convert dplyr syntax to
  data.table syntax. This takes time proportional to the complexity of
  the input code, not the input *data*, so should be a negligible
  overhead for large datasets. [Initial
  benchmarks](https://dtplyr.tidyverse.org/articles/translation.html#performance)
  suggest that the overhead should be under 1ms per dplyr call.

- To match dplyr semantics,
  [`mutate()`](https://dplyr.tidyverse.org/reference/mutate.html) does
  not modify in place by default. This means that most expressions
  involving
  [`mutate()`](https://dplyr.tidyverse.org/reference/mutate.html) must
  make a copy that would not be necessary if you were using data.table
  directly. (You can opt out of this behaviour in
  [`lazy_dt()`](https://dtplyr.tidyverse.org/dev/reference/lazy_dt.md)
  with `immutable = FALSE`).

## Code of Conduct

Please note that the dtplyr project is released with a [Contributor Code
of Conduct](https://dtplyr.tidyverse.org/CODE_OF_CONDUCT.html). By
contributing to this project, you agree to abide by its terms.

# Package index

## Getting data in and out

- [`lazy_dt()`](https://dtplyr.tidyverse.org/dev/reference/lazy_dt.md) :
  Create a "lazy" data.table for use with dplyr verbs
- [`collect(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/collect.dtplyr_step.md)
  [`compute(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/collect.dtplyr_step.md)
  [`as.data.table(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/collect.dtplyr_step.md)
  [`as.data.frame(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/collect.dtplyr_step.md)
  [`as_tibble(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/collect.dtplyr_step.md)
  : Force computation of a lazy data.table

## Single table verbs

- [`arrange(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/arrange.dtplyr_step.md)
  : Arrange rows by column values
- [`count(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/count.dtplyr_step.md)
  : Count observations by group
- [`distinct(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/distinct.dtplyr_step.md)
  : Subset distinct/unique rows
- [`filter(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/filter.dtplyr_step.md)
  : Subset rows using column values
- [`group_by(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/group_by.dtplyr_step.md)
  [`ungroup(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/group_by.dtplyr_step.md)
  : Group and ungroup
- [`group_modify(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/group_modify.dtplyr_step.md)
  [`group_map(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/group_modify.dtplyr_step.md)
  : Apply a function to each group
- [`head(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/head.dtplyr_step.md)
  [`tail(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/head.dtplyr_step.md)
  : Subset first or last rows
- [`mutate(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/mutate.dtplyr_step.md)
  : Create and modify columns
- [`transmute(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/transmute.dtplyr_step.md)
  : Create new columns, dropping old
- [`relocate(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/relocate.dtplyr_step.md)
  : Relocate variables using their names
- [`rename(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/rename.dtplyr_step.md)
  [`rename_with(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/rename.dtplyr_step.md)
  : Rename columns using their names
- [`reframe(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/reframe.dtplyr_step.md)
  : Summarise each group to one row
- [`select(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/select.dtplyr_step.md)
  : Subset columns using their names
- [`slice(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/slice.dtplyr_step.md)
  [`slice_head(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/slice.dtplyr_step.md)
  [`slice_tail(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/slice.dtplyr_step.md)
  [`slice_min(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/slice.dtplyr_step.md)
  [`slice_max(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/slice.dtplyr_step.md)
  : Subset rows using their positions
- [`summarise(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/summarise.dtplyr_step.md)
  : Summarise each group to one row

## Two table verbs

- [`left_join(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/left_join.dtplyr_step.md)
  : Join data tables
- [`intersect(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/intersect.dtplyr_step.md)
  [`union(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/intersect.dtplyr_step.md)
  [`union_all(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/intersect.dtplyr_step.md)
  [`setdiff(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/intersect.dtplyr_step.md)
  : Set operations

## tidyr verbs

- [`complete(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/complete.dtplyr_step.md)
  : Complete a data frame with missing combinations of data
- [`drop_na(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/drop_na.dtplyr_step.md)
  : Drop rows containing missing values
- [`expand(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/expand.dtplyr_step.md)
  : Expand data frame to include all possible combinations of values.
- [`fill(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/fill.dtplyr_step.md)
  : Fill in missing values with previous or next value
- [`nest(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/nest.dtplyr_step.md)
  : Nest
- [`pivot_wider(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/pivot_wider.dtplyr_step.md)
  : Pivot data from long to wide
- [`pivot_longer(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/pivot_longer.dtplyr_step.md)
  : Pivot data from wide to long
- [`replace_na(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/replace_na.dtplyr_step.md)
  : Replace NAs with specified values
- [`separate(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/separate.dtplyr_step.md)
  : Separate a character column into multiple columns with a regular
  expression or numeric locations
- [`unite(`*`<dtplyr_step>`*`)`](https://dtplyr.tidyverse.org/dev/reference/unite.dtplyr_step.md)
  : Unite multiple columns into one by pasting strings together.

# Articles

### All vignettes

- [Translation](https://dtplyr.tidyverse.org/dev/articles/translation.md):
